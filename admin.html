<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Admin Panel</title>
<link rel="stylesheet" href="css/style.css">
<!-- Firebase libs -->
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
<!-- Ensure auth.js runs first to init Firebase -->
<script src="js/auth.js"></script>
<script src="js/admin.js"></script>
<script src="js/firebase_init.js"></script><script src="js/auth.js"></script></head>
<body class="theme-dark"><div class="app"><aside class="sidebar"><a class="icon" href="admin.html" title="Admin Panel">üõ†Ô∏è</a>
<!-- Admin & Friends Quick Links -->
<div style="margin-top:8px;display:flex;flex-direction:column;gap:6px">
  <a class="icon" href="friends.html" title="Friends">üë•</a>
  <a class="icon" href="requests.html" title="Requests">üì®</a>
  <a id="adminQuick" class="icon" href="admin.html" title="Admin" style="display:none">‚öôÔ∏è</a>
</div>
<script>
// show admin link if current user is admin (stored in localStorage ADMIN_EMAIL)
firebase && firebase.auth && firebase.auth().onAuthStateChanged(function(u){
  if(!u) return;
  var admin = (localStorage.getItem('ADMIN_EMAIL')||'proadmin@proton.me').trim().toLowerCase();
  if(u.email && u.email.trim().toLowerCase()===admin){
    var el = document.getElementById('adminQuick');
    if(el) el.style.display='inline-flex';
  }
});
</script>
<div class="logo"><img src="assets/server_logo.svg" style="width:48px;height:48px"></div><a class="icon" href="chat.html">üè†</a><a class="icon" href="dm.html">üí¨</a><a class="icon" href="friends.html">üë•</a><a class="icon" href="games.html">üéÆ</a><a class="icon" href="notifications.html">üîî</a></aside><div class="main"><div class="header"><div class="server-title">ChatPack</div></div><div class="content"><div class="channels" style="display:none"></div><div class="chat-area">

<!-- GLOBAL CUSTOMIZATION LOADER -->
<script>
(function(){
  const custom = JSON.parse(localStorage.getItem('siteCustom')||'{}');
  if(custom.bgUrl){ document.body.style.backgroundImage = `url(${custom.bgUrl})`; }
  if(custom.accentColor){
    document.documentElement.style.setProperty('--accent', custom.accentColor);
  }
  if(custom.logoUrl){
    const logo=document.querySelector('.site-logo');
    if(logo) logo.src=custom.logoUrl;
  }
  if(custom.siteTitle){
    const t=document.querySelector('.site-title');
    if(t) t.textContent=custom.siteTitle;
    document.title = custom.siteTitle;
  }
})();
</script>


<main>
  <h2>Admin Control Panel</h2>

  <section class="card">
    <h3>Ban User</h3>
    <input id="banEmail" placeholder="Email to ban">
    <button onclick="banUser()">Ban</button>
  </section>

  <section class="card">
    <h3>Unban User</h3>
    <input id="unbanEmail" placeholder="Email to unban">
    <button onclick="unbanUser()">Unban</button>
  </section>

  <section class="card">
    <h3>Mute User</h3>
    <input id="muteEmail" placeholder="Email to mute">
    <button onclick="muteUser()">Mute</button>
  </section>

  <section class="card">
    <h3>Clear Global Chat</h3>
    <button onclick="clearChat()">Clear</button>
  </section>

  <section class="card">
    <h3>Broadcast Message</h3>
    <input id="broadcastText" placeholder="Message...">
    <button onclick="broadcastMsg()">Send</button>
  </section>
</main>

<script>
function key(e){ return e.toLowerCase().replace(/\./g,'_'); }

function banUser(){
  let email=document.getElementById("banEmail").value;
  if(!email) return;
  firebase.database().ref("bans/"+key(email)).set(true);
  alert("Banned.");
}
function unbanUser(){
  let email=document.getElementById("unbanEmail").value;
  if(!email) return;
  firebase.database().ref("bans/"+key(email)).remove();
  alert("Unbanned.");
}
function muteUser(){
  let email=document.getElementById("muteEmail").value;
  if(!email) return;
  firebase.database().ref("mutes/"+key(email)).set(true);
  alert("Muted.");
}
function clearChat(){
  firebase.database().ref("messages").set(null);
  alert("Chat cleared.");
}
function broadcastMsg(){
  let t=document.getElementById("broadcastText").value;
  if(!t) return;
  firebase.database().ref("broadcasts").push({text:t,ts:Date.now()});
  alert("Broadcast sent.");
}
</script>
</body>
</html></div></div></div></div>
<!-- GLOBAL CUSTOMIZATION LOADER -->
<script>
(function(){
  const custom = JSON.parse(localStorage.getItem('siteCustom')||'{}');
  if(custom.bgUrl){ document.body.style.backgroundImage = `url(${custom.bgUrl})`; }
  if(custom.accentColor){
    document.documentElement.style.setProperty('--accent', custom.accentColor);
  }
  if(custom.logoUrl){
    const logo=document.querySelector('.site-logo');
    if(logo) logo.src=custom.logoUrl;
  }
  if(custom.siteTitle){
    const t=document.querySelector('.site-title');
    if(t) t.textContent=custom.siteTitle;
    document.title = custom.siteTitle;
  }
})();
</script>


<main>
  <h2>Admin Control Panel</h2>

  <section class="card">
    <h3>Ban User</h3>
    <input id="banEmail" placeholder="Email to ban">
    <button onclick="banUser()">Ban</button>
  </section>

  <section class="card">
    <h3>Unban User</h3>
    <input id="unbanEmail" placeholder="Email to unban">
    <button onclick="unbanUser()">Unban</button>
  </section>

  <section class="card">
    <h3>Mute User</h3>
    <input id="muteEmail" placeholder="Email to mute">
    <button onclick="muteUser()">Mute</button>
  </section>

  <section class="card">
    <h3>Clear Global Chat</h3>
    <button onclick="clearChat()">Clear</button>
  </section>

  <section class="card">
    <h3>Broadcast Message</h3>
    <input id="broadcastText" placeholder="Message...">
    <button onclick="broadcastMsg()">Send</button>
  </section>
</main>

<script>
function key(e){ return e.toLowerCase().replace(/\./g,'_'); }

function banUser(){
  let email=document.getElementById("banEmail").value;
  if(!email) return;
  firebase.database().ref("bans/"+key(email)).set(true);
  alert("Banned.");
}
function unbanUser(){
  let email=document.getElementById("unbanEmail").value;
  if(!email) return;
  firebase.database().ref("bans/"+key(email)).remove();
  alert("Unbanned.");
}
function muteUser(){
  let email=document.getElementById("muteEmail").value;
  if(!email) return;
  firebase.database().ref("mutes/"+key(email)).set(true);
  alert("Muted.");
}
function clearChat(){
  firebase.database().ref("messages").set(null);
  alert("Chat cleared.");
}
function broadcastMsg(){
  let t=document.getElementById("broadcastText").value;
  if(!t) return;
  firebase.database().ref("broadcasts").push({text:t,ts:Date.now()});
  alert("Broadcast sent.");
}
</script>
</body></html>
<div class="card">
  <h3>Admin Panel</h3>
  <div><button onclick="location.href='admin-users.html'">Manage Users</button> <button onclick="location.href='games.html'">Manage Games</button></div>
  <div style="margin-top:8px">
    <button onclick="db.ref('messages').set(null); alert('Cleared global messages')">Clear All Messages</button>
  </div>
</div>
